<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Revival Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--muted:#334155;--text:#e5e7eb}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);display:flex;min-height:100vh}
    #sidebar{width:220px;background:var(--panel);padding:16px 12px;display:flex;flex-direction:column;gap:8px}
    #brand{font-weight:700;margin-bottom:8px}
    .robux{margin-top:4px;font-size:.95rem;opacity:.9}
    .btn{width:100%;padding:10px;background:#1f2937;border:1px solid #243041;border-radius:10px;color:var(--text);cursor:pointer;text-align:left}
    .btn:hover{background:#222f43}
    #content{flex:1;padding:20px}
    .card{background:#0b1220;border:1px solid #1b2940;border-radius:14px;padding:16px;margin-bottom:16px}
    input{width:100%;padding:10px;border:1px solid #263349;border-radius:10px;background:#0b1324;color:var(--text);margin:6px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px}
    .item{background:#111827;border:1px solid #243041;border-radius:12px;padding:12px;text-align:center}
    .item img{width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:8px}
    .item b{display:block;margin:4px 0}
    .inline-btn{padding:6px 10px;border:1px solid #2b3953;border-radius:8px;background:#182339;color:var(--text);cursor:pointer}
    .inline-btn:hover{background:#1b2740}
    .hidden{display:none}
    .pill{display:inline-block;padding:2px 8px;border:1px solid #2b3953;border-radius:999px;font-size:.8rem;margin-left:6px}
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
  <aside id="sidebar">
    <div id="brand">Revival Hub</div>
    <div id="userBox" class="card">
      <div id="authBox">
        <input id="user" placeholder="Usuario">
        <input id="pass" placeholder="Contrase침a" type="password">
        <button class="btn" onclick="register()">Registrar</button>
        <button class="btn" onclick="login()">Login</button>
      </div>
      <div id="sessionBox" class="hidden">
        <div>Hola, <b id="who"></b><span id="adminTag" class="pill hidden">ADMIN</span></div>
        <div class="robux">游눯 Robux: <b id="robux">0</b></div>
        <button class="btn" onclick="logout()">Cerrar sesi칩n</button>
      </div>
    </div>

    <button class="btn" onclick="loadMarket()">Marketplace</button>
    <button class="btn" onclick="loadProfile()">Profile</button>
    <button class="btn" onclick="loadPromocodes()">Promocodes</button>
    <button class="btn" onclick="loadTradeos()">Tradeos</button>
    <button class="btn" onclick="loadFriends()">Friends</button>
  </aside>

  <main id="content">
    <div class="card"><h2>Bienvenido a Revival Hub</h2><p class="muted">Reg칤strate o inicia sesi칩n para empezar.</p></div>
  </main>

  <script>
    // === Firebase ===
    const firebaseConfig={apiKey:"AIzaSyBwj_as6pb5Bg81F9Cl9VWTKkekMM9Exfk",authDomain:"pekora-forum.firebaseapp.com",projectId:"pekora-forum"};
    firebase.initializeApp(firebaseConfig);const db=firebase.firestore();
    let currentUser=null;

    // === Registro/Login ===
    async function register(){
      const u=document.getElementById("user").value,p=document.getElementById("pass").value;
      if(!u||!p) return alert("Completa los campos");
      if((await db.collection("users").doc(u).get()).exists) return alert("Usuario ya existe");
      await db.collection("users").doc(u).set({username:u,password:p,robux:100,friends:[],requests:[]});
      alert("Registrado correctamente, inicia sesi칩n");
    }
    async function login(){
      const u=document.getElementById("user").value,p=document.getElementById("pass").value;
      const snap=await db.collection("users").doc(u).get();
      if(!snap.exists) return alert("Usuario no existe");
      if(snap.data().password!==p) return alert("Contrase침a incorrecta");
      currentUser=u;localStorage.setItem("currentUser",u);startApp();
    }
    function logout(){currentUser=null;localStorage.removeItem("currentUser");location.reload();}
    window.onload=function(){const u=localStorage.getItem("currentUser");if(u){currentUser=u;startApp();}}

    async function startApp(){
      document.getElementById("authBox").classList.add("hidden");
      document.getElementById("sessionBox").classList.remove("hidden");
      document.getElementById("who").innerText=currentUser;
      if(currentUser==="ROBLOX")document.getElementById("adminTag").classList.remove("hidden");
      updateRobux();
    }
    async function updateRobux(){const s=await db.collection("users").doc(currentUser).get();if(s.exists)document.getElementById("robux").innerText=s.data().robux;}

    // === Marketplace (Dise침o Antiguo) ===
    async function loadMarket(){
      const c=document.getElementById("content");
      c.innerHTML="<div class='card'><h2>Marketplace</h2><div id='marketGrid' class='grid'></div></div>";
      const q=await db.collection("items").get();const grid=document.getElementById("marketGrid");grid.innerHTML="";
      if(q.empty){grid.innerHTML="<div class='muted'>No hay 칤tems a칰n</div>";return;}
      q.forEach(d=>{
        const it=d.data();
        grid.innerHTML+=`
          <div class='item'>
            <img src='${it.img||""}'>
            <b>${it.name}</b>
            <div>${it.price} 游눯</div>
            <button class='inline-btn' onclick="buyItem('${d.id}')">Comprar</button>
          </div>`;
      });
    }
    async function buyItem(id){
      const r=await db.collection("items").doc(id).get();if(!r.exists)return;
      const it=r.data();const ur=await db.collection("users").doc(currentUser).get();if(!ur.exists)return;
      const u=ur.data();if(u.robux<it.price)return alert("No tienes Robux suficientes");
      await db.collection("users").doc(currentUser).update({robux:u.robux-it.price});
      await db.collection("users").doc(currentUser).collection("inventory").add(it);
      alert("Comprado!");updateRobux();
    }

    // === Profile (Dise침o Antiguo) ===
    async function loadProfile(){
      const c=document.getElementById("content");
      c.innerHTML="<div class='card'><h2>Mi Perfil</h2><div id='invGrid' class='grid'></div></div>";
      const q=await db.collection("users").doc(currentUser).collection("inventory").get();const grid=document.getElementById("invGrid");grid.innerHTML="";
      if(q.empty){grid.innerHTML="<div class='muted'>No tienes 칤tems</div>";return;}
      q.forEach(d=>{
        const it=d.data();
        grid.innerHTML+=`
          <div class='item'>
            <img src='${it.img||""}'>
            <b>${it.name}</b>
          </div>`;
      });
    }

    // === Promocodes ===
    async function loadPromocodes(){
      const c=document.getElementById("content");
      c.innerHTML=`<div class='card'><h2>Promocodes</h2><input id='code' placeholder='C칩digo'><button class='inline-btn' onclick='redeemCode()'>Canjear</button></div>`;
      if(currentUser==="ROBLOX"){c.innerHTML+=`<div class='card'><h3>Crear c칩digo</h3><input id='newCode' placeholder='C칩digo'><input id='reward' placeholder='Recompensa'><button class='inline-btn' onclick='createCode()'>Crear</button></div>`;}
    }
    async function redeemCode(){const c=document.getElementById("code").value;const snap=await db.collection("codes").doc(c).get();if(!snap.exists)return alert("C칩digo inv치lido");const data=snap.data();if(data.robux){const uref=db.collection("users").doc(currentUser);const usnap=await uref.get();await uref.update({robux:usnap.data().robux+data.robux});}if(data.item){await db.collection("users").doc(currentUser).collection("inventory").add(data.item);}alert("C칩digo canjeado!");updateRobux();}
    async function createCode(){const c=document.getElementById("newCode").value;const r=document.getElementById("reward").value;await db.collection("codes").doc(c).set({robux:parseInt(r)});alert("C칩digo creado!");}

    // === Friends (igual que antes) ===
    async function loadFriends(){
      const c=document.getElementById("content");
      c.innerHTML="<div class='card'><h2>Amigos</h2><input id='searchFriend' placeholder='Buscar usuario'><button class='inline-btn' onclick='sendRequest()'>Agregar</button><div id='friendSection'></div></div>";
      renderFriends();
    }
    async function sendRequest(){const target=document.getElementById("searchFriend").value;if(!target)return;const tRef=db.collection("users").doc(target);if(!(await tRef.get()).exists)return alert("Usuario no encontrado");await tRef.update({requests:firebase.firestore.FieldValue.arrayUnion(currentUser)});alert("Solicitud enviada");}
    async function renderFriends(){const uref=db.collection("users").doc(currentUser);const u=(await uref.get()).data();const box=document.getElementById("friendSection");box.innerHTML="<h3>Solicitudes</h3>";(u.requests||[]).forEach(r=>{box.innerHTML+=`${r} <button class='inline-btn' onclick="acceptFriend('${r}')">Aceptar</button><br>`;});box.innerHTML+="<h3>Amigos</h3>";(u.friends||[]).forEach(f=>{box.innerHTML+=`${f} <button class='inline-btn' onclick="giftRobuxPrompt('${f}')">游꾸 Dar Robux</button><br>`;});}
    async function acceptFriend(name){const uref=db.collection("users").doc(currentUser);await uref.update({friends:firebase.firestore.FieldValue.arrayUnion(name),requests:firebase.firestore.FieldValue.arrayRemove(name)});const fref=db.collection("users").doc(name);await fref.update({friends:firebase.firestore.FieldValue.arrayUnion(currentUser)});renderFriends();}
    function giftRobuxPrompt(friend){const amount=prompt("쮺u치ntos Robux quieres enviar a "+friend+"?");if(!amount)return;const msg=prompt("Mensaje para "+friend+":","Aqu칤 tienes!");sendGift(friend,parseInt(amount),msg);}
    async function sendGift(friend,amount,msg){const uref=db.collection("users").doc(currentUser);const usnap=await uref.get();const u=usnap.data();if(u.robux<amount)return alert("No tienes suficientes Robux");await uref.update({robux:u.robux-amount});const fref=db.collection("users").doc(friend);const fsnap=await fref.get();await fref.update({robux:(fsnap.data().robux||0)+amount});alert("Enviaste "+amount+" Robux a "+friend+" con mensaje: "+msg);updateRobux();}
  </script>
</body>
</html>
