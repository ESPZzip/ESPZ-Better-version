<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>XD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--text:#e5e7eb;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);display:flex;min-height:100vh}
    #sidebar{width:220px;background:var(--panel);padding:16px 12px;display:flex;flex-direction:column;gap:8px}
    #brand{font-weight:700;margin-bottom:8px}
    .robux{margin-top:4px;font-size:.95rem;opacity:.9}
    .btn{width:100%;padding:10px;background:#1f2937;border:1px solid #243041;border-radius:10px;color:var(--text);cursor:pointer;text-align:left}
    .btn:hover{background:#222f43}
    #content{flex:1;padding:20px}
    .card{background:#0b1220;border:1px solid #1b2940;border-radius:14px;padding:16px;margin-bottom:16px}
    input,select,textarea{width:100%;padding:10px;border:1px solid #263349;border-radius:10px;background:#0b1324;color:var(--text);margin:6px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px}
    .item{background:#111827;border:1px solid #243041;border-radius:12px;padding:12px;text-align:center;position:relative}
    .item img{width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:8px}
    .tag{position:absolute;top:8px;left:8px;font-size:.75rem;padding:2px 6px;border-radius:8px}
    .inline-btn{padding:6px 10px;border:1px solid #2b3953;border-radius:8px;background:#182339;color:var(--text);cursor:pointer}
    .inline-btn:hover{background:#1b2740}
    .hidden{display:none}
    .pill{display:inline-block;padding:2px 8px;border:1px solid #2b3953;border-radius:999px;font-size:.8rem;margin-left:6px}
    .muted{color:var(--muted)}
    /* Toasts */
    #toasts{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}
    .toast{background:#1f2937;color:#fff;padding:10px 16px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.3);animation:fadein .3s}
    @keyframes fadein{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
  <aside id="sidebar">
    <div id="brand">Revival Hub</div>
    <div id="userBox" class="card">
      <div id="authBox">
        <input id="user" placeholder="Usuario">
        <input id="pass" placeholder="ContraseÃ±a" type="password">
        <div class="grid" style="grid-template-columns:1fr 1fr">
          <button class="btn" onclick="register()">Registrar</button>
          <button class="btn" onclick="login()">Login</button>
        </div>
      </div>
      <div id="sessionBox" class="hidden">
        <div>Hola, <b id="who"></b><span id="adminTag" class="pill hidden">ADMIN</span></div>
        <div class="robux">ðŸ’° Robux: <b id="robux">0</b></div>
        <div style="margin-top:8px"><button class="btn" onclick="logout()">Cerrar sesiÃ³n</button></div>
      </div>
    </div>
    <button class="btn" onclick="loadMarket()">Marketplace</button>
    <button class="btn" onclick="loadProfile()">Profile</button>
    <button class="btn" onclick="loadPromocodes()">Promocodes</button>
    <button class="btn" onclick="loadTradeos()">Tradeos</button>
    <button class="btn" onclick="loadFriends()">Friends</button>
  </aside>

  <main id="content">
    <div class="card"><h2>Bienvenido a Revival Hub</h2><p class="muted">RegÃ­strate o inicia sesiÃ³n para empezar.</p></div>
  </main>

  <!-- Toast container -->
  <div id="toasts"></div>

  <script>
    const firebaseConfig={apiKey:"AIzaSyBwj_as6pb5Bg81F9Cl9VWTKkekMM9Exfk",authDomain:"pekora-forum.firebaseapp.com",projectId:"pekora-forum"};
    firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();
    let currentUser=null;
    function $(id){return document.getElementById(id);}
    function showToast(msg){const box=$("toasts");const t=document.createElement("div");t.className="toast";t.innerText=msg;box.appendChild(t);setTimeout(()=>t.remove(),4000);}

    // ======= Login/Register (igual que tenÃ­as) =======
    async function register(){/* ... */}
    async function login(){/* ... */}
    function logout(){/* ... */}
    async function startApp(){/* ... */}

    // ======= Tradeos =======
    async function loadTradeos(){
      const c=$("content");
      c.innerHTML=`
        <div class="card">
          <h2>Tradeos</h2>
          <div class="cols">
            <div>
              <h3>Entrantes</h3>
              <div id="incoming" class="list">Cargandoâ€¦</div>
            </div>
            <div>
              <h3>Salientes</h3>
              <div id="outgoing" class="list">Cargandoâ€¦</div>
            </div>
          </div>
        </div>`;
      renderTrades();
    }

    function renderTrades(){
      const incBox=$("incoming"),outBox=$("outgoing");

      // Entrantes en tiempo real
      db.collection("trades")
        .where("to","==",currentUser)
        .where("status","==","pending")
        .orderBy("ts","desc")
        .onSnapshot(snapshot=>{
          incBox.innerHTML="";
          if(snapshot.empty){incBox.innerHTML="<div class='muted'>Sin trades</div>";return;}
          snapshot.forEach(d=>{
            const t=d.data();
            incBox.innerHTML+=`
              <div class="card">
                <div><b>${t.from}</b> te enviÃ³ un trade (${t.offered.length} Ã­tem(s) por ${t.requested.length})</div>
                <div class="row">
                  <button class="inline-btn" onclick="acceptTrade('${d.id}')">Aceptar</button>
                  <button class="inline-btn" onclick="declineTrade('${d.id}')">Rechazar</button>
                </div>
              </div>`;
            if(!t.notified){
              showToast("ðŸ“© Nuevo tradeo recibido de "+t.from);
              db.collection("trades").doc(d.id).update({notified:true});
            }
          });
        });

      // Salientes en tiempo real
      db.collection("trades")
        .where("from","==",currentUser)
        .orderBy("ts","desc")
        .onSnapshot(snapshot=>{
          outBox.innerHTML="";
          if(snapshot.empty){outBox.innerHTML="<div class='muted'>Sin trades</div>";return;}
          snapshot.forEach(d=>{
            const t=d.data();
            outBox.innerHTML+=`<div class="card">Para <b>${t.to}</b> Â· Estado: ${t.status}</div>`;
          });
        });
    }

    async function sendTrade(friend,offeredObjs,requestedObjs){
      await db.collection("trades").add({
        from:currentUser,to:friend,
        offered:offeredObjs,requested:requestedObjs,
        status:"pending",ts:Date.now(),notified:false
      });
      showToast("âœ… Tradeo enviado a "+friend);
    }

    async function acceptTrade(id){/* ... */}
    async function declineTrade(id){/* ... */}
  </script>
</body>
</html>
